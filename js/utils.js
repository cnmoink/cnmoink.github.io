KEEP.initUtils=()=>{KEEP.utils={html_root_dom:document.querySelector("html"),pageContainer_dom:document.querySelector(".page-container"),pageTop_dom:document.querySelector(".page-main-content-top"),firstScreen_dom:document.querySelector(".first-screen-container"),scrollProgressBar_dom:document.querySelector(".scroll-progress-bar"),pjaxProgressBar_dom:document.querySelector(".pjax-progress-bar"),pjaxProgressIcon_dom:document.querySelector(".pjax-progress-icon"),back2TopButton_dom:document.querySelector(".tool-scroll-to-top"),headerWrapper_dom:document.querySelector(".header-wrapper"),innerHeight:window.innerHeight,pjaxProgressBarTimer:null,prevScrollValue:0,fontSizeLevel:0,isHasScrollProgressBar:false,isHasScrollPercent:false,isHeaderTransparent:false,hasToc:false,initData(){const{scroll:e,first_screen:t}=KEEP.theme_config.style;this.isHasScrollProgressBar=e.progress_bar===true;this.isHasScrollPercent=e.percent===true;const{enable:o,header_transparent:s}=t;this.isHeaderTransparent=o===true&&s===true},styleHandleWhenScroll(){const e=document.body.scrollTop||document.documentElement.scrollTop;const t=document.body.scrollHeight||document.documentElement.scrollHeight;const o=window.innerHeight||document.documentElement.clientHeight;const s=Math.round(e/(t-o)*100);if(this.isHasScrollProgressBar){const r=(e/(t-o)*100).toFixed(3);this.scrollProgressBar_dom.style.visibility=s===0?"hidden":"visible";this.scrollProgressBar_dom.style.width=`${r}%`}if(this.isHasScrollPercent){const e=this.back2TopButton_dom.querySelector(".percent");if(s===0||s===undefined){this.back2TopButton_dom.classList.remove("show")}else{this.back2TopButton_dom.classList.add("show");e.innerHTML=s.toFixed(0)}}if(e>this.prevScrollValue&&e>this.innerHeight){this.pageTop_dom.classList.add("hide");if(this.isHeaderTransparent){this.headerWrapper_dom.classList.remove("transparent-1","transparent-2")}}else{this.pageTop_dom.classList.remove("hide");if(this.isHeaderTransparent){if(e<=this.headerWrapper_dom.getBoundingClientRect().height){this.headerWrapper_dom.classList.remove("transparent-2");this.headerWrapper_dom.classList.add("transparent-1")}else if(e<this.innerHeight){this.headerWrapper_dom.classList.add("transparent-2")}}}this.prevScrollValue=e},registerWindowScroll(){window.addEventListener("scroll",(()=>{this.styleHandleWhenScroll();if(KEEP.theme_config.toc.enable&&KEEP.utils.hasOwnProperty("findActiveIndexByTOC")){KEEP.utils.findActiveIndexByTOC()}KEEP.utils.headerShrink.headerShrink()}))},toggleShowToolsList(){const e=document.querySelector(".side-tools-list");const t=document.querySelector(".tool-toggle-show");t.addEventListener("click",(t=>{e.classList.toggle("show");t.stopPropagation()}));e.querySelectorAll(".tools-item").forEach((e=>{e.addEventListener("click",(e=>{e.stopPropagation()}))}));document.addEventListener("click",(()=>{e.classList.contains("show")&&e.classList.remove("show")}))},globalFontAdjust(){const e=document.defaultView.getComputedStyle(document.body).fontSize;const t=parseFloat(e);const o=()=>{const e=KEEP.getStyleStatus();if(e){this.fontSizeLevel=e.fontSizeLevel;s(this.fontSizeLevel)}};const s=e=>{this.html_root_dom.style.fontSize=`${t*(1+e*.05)}px`;KEEP.styleStatus.fontSizeLevel=e;KEEP.setStyleStatus()};o();document.querySelector(".tool-font-adjust-plus").addEventListener("click",(()=>{if(this.fontSizeLevel===5)return;this.fontSizeLevel++;s(this.fontSizeLevel)}));document.querySelector(".tool-font-adjust-minus").addEventListener("click",(()=>{if(this.fontSizeLevel<=0)return;this.fontSizeLevel--;s(this.fontSizeLevel)}))},getElementHeight(e){const t=document.querySelector(e);return t?t.getBoundingClientRect().height:0},initHasToc(){const e=document.querySelectorAll(".post-toc-wrap .post-toc li");if(e.length>0){this.hasToc=true;document.body.classList.add("has-toc")}else{this.hasToc=false;document.body.classList.remove("has-toc")}},initPageHeightHandle(){if(this.firstScreen_dom)return;const e=this.getElementHeight(".page-main-content-top");const t=this.getElementHeight(".page-main-content-middle");const o=this.getElementHeight(".page-main-content-bottom");const s=e+t+o;const r=window.innerHeight;const i=document.querySelector(".page-main-content-bottom");if(s<r){const e=Math.floor(r-s);if(e>0){i.style.marginTop=`${e-2}px`}}},zoomInImage(){let e=40;let t=false;let o=0;let s=null;const r=document.querySelectorAll(".keep-markdown-body img");const i=document.querySelector(".zoom-in-image-mask");const n=i.querySelector(".zoom-in-image");const a=()=>{if(t){t=false;o=0;n&&(n.style.transform=`scale(1)`);i&&i.classList.remove("show");setTimeout((()=>{s&&s.classList.remove("hide")}),300)}};const l=()=>{i&&i.addEventListener("click",(()=>{a()}));document.addEventListener("scroll",(()=>{if(t&&Math.abs(o-window.scrollY)>=50){a()}}))};const c=()=>{const t=document.body.offsetWidth;if(t<=500){e=10}else if(t<=800){e=20}else{e=40}};if(r.length){l();r.forEach((r=>{r.addEventListener("click",(()=>{o=window.scrollY;t=!t;c();n.setAttribute("src",r.getAttribute("src"));s=r;if(t){const t=s.getBoundingClientRect();const o=t.width;const r=t.height;const a=t.left;const l=t.top;const c=document.body.offsetWidth-e*2;const d=document.body.offsetHeight-e*2;const h=c/o;const g=d/r;const m=(h<g?h:g)||1;const u=c/2-(t.x+o/2)+e;const p=d/2-(t.y+r/2)+e;s.classList.add("hide");i.classList.add("show");n.style.top=l+"px";n.style.left=a+"px";n.style.width=o+"px";n.style.height=r+"px";n.style.transform=`translateX(${u}px) translateY(${p}px) scale(${m}) `}}))}))}},setHowLongAgoLanguage(e,t){return t.replace(/%s/g,e)},getHowLongAgo(e){const t=KEEP.language_ago;const o=Math.floor(e/(60*60*24*30)/12);const s=Math.floor(e/(60*60*24*30));const r=Math.floor(e/(60*60*24)/7);const i=Math.floor(e/(60*60*24));const n=Math.floor(e/(60*60)%24);const a=Math.floor(e/60%60);const l=Math.floor(e%60);if(o>0){return this.setHowLongAgoLanguage(o,t.year)}else if(s>0){return this.setHowLongAgoLanguage(s,t.month)}else if(r>0){return this.setHowLongAgoLanguage(r,t.week)}else if(i>0){return this.setHowLongAgoLanguage(i,t.day)}else if(n>0){return this.setHowLongAgoLanguage(n,t.hour)}else if(a>0){return this.setHowLongAgoLanguage(a,t.minute)}else if(l>0){return this.setHowLongAgoLanguage(l,t.second)}},setHowLongAgoInHome(){const e=document.querySelectorAll(".home-article-meta-info .home-article-date");e&&e.forEach((e=>{const t=Date.now();const o=new Date(e.dataset.updated.split(" GMT")[0]).getTime();e.innerHTML=this.getHowLongAgo(Math.floor((t-o)/1e3))}))},pjaxProgressBarStart(){this.pjaxProgressBarTimer&&clearInterval(this.pjaxProgressBarTimer);if(this.isHasScrollProgressBar){this.scrollProgressBar_dom.classList.add("hide")}this.pjaxProgressBar_dom.style.width="0";this.pjaxProgressIcon_dom.classList.add("show");let e=1;const t=99;this.pjaxProgressBar_dom.classList.add("show");this.pjaxProgressBar_dom.style.width=e+"%";this.pjaxProgressBarTimer=setInterval((()=>{e+=5;if(e>t)e=t;this.pjaxProgressBar_dom.style.width=e+"%"}),100)},pjaxProgressBarEnd(){this.pjaxProgressBarTimer&&clearInterval(this.pjaxProgressBarTimer);this.pjaxProgressBar_dom.style.width="100%";const e=setTimeout((()=>{this.pjaxProgressBar_dom.classList.remove("show");this.pjaxProgressIcon_dom.classList.remove("show");if(this.isHasScrollProgressBar){this.scrollProgressBar_dom.classList.remove("hide")}const t=setTimeout((()=>{this.pjaxProgressBar_dom.style.width="0";clearTimeout(e),clearTimeout(t)}),200)}),200)},insertTooltipContent(){const e=()=>{document.querySelectorAll(".tooltip").forEach((e=>{const{content:t,offsetX:o,offsetY:s}=e.dataset;let r="";let i="";let n="";if(o){i=`left: ${o};`}if(s){n=`top: ${s};`}if(o||s){r=` style="${n}${i}"`}if(t){e.insertAdjacentHTML("afterbegin",`<span class="tooltip-content"${r}>${t}</span>`)}}));const e={};const t=(t,o)=>{document.addEventListener("click",(()=>{if(e[o].isShowImg){t.classList.remove("show-img");e[o].isShowImg=false}}))};const o=(e,t)=>{const o=new Image;const{src:s}=e.dataset;o.src=s;o.onload=()=>{e.src=s;e.removeAttribute("lazyload");t=true}};document.querySelectorAll(".tooltip-img").forEach(((s,r)=>{const{imgUrl:i,name:n}=s.dataset;if(i){const a=`tooltip-img-${n}`;const l=`${n}_${r}`;const c=`<img class="${a}" lazyload data-src="${i}" alt="${n}">`;const d=`<div class="tooltip-img-box">${c}</div>`;e[l]={imgLoaded:false,isShowImg:false};s.insertAdjacentHTML("afterbegin",d);s.addEventListener("click",(t=>{if(!e[l].imgLoaded){o(document.querySelector(`.tooltip-img-box img.${a}`),e[l].imgLoaded)}e[l].isShowImg=!e[l].isShowImg;s.classList.toggle("show-img");t.stopPropagation()}));t(s,l)}}))};setTimeout((()=>{e()}),1e3)}};KEEP.utils.initData();KEEP.utils.registerWindowScroll();KEEP.utils.toggleShowToolsList();KEEP.utils.globalFontAdjust();KEEP.utils.initPageHeightHandle();KEEP.utils.initHasToc();KEEP.utils.zoomInImage();KEEP.utils.setHowLongAgoInHome();KEEP.utils.insertTooltipContent()};